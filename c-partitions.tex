%\chapter{Integer Partitions and the Natural Power Monoid}
\chapter{Partitions and Intervals in the Natural Power Monoid} \label{ch:partitions}


In \cite[Section 4]{fan-tringali18}, Fan and Tringali took a thorough look at $\PN$.
They established, among other things, some significant results on which sets may occur as sets of lengths of elements of $\PN$.  
Several of their results (which will be addressed further in Chapter \ref{ch:lattices}) specify some elements of $\PN$ with very well-controlled sets of factorizations.
To contrast with this, they also proved \cite[Proposition 4.8]{fan-tringali18}, which says that $\mathsf{L}_\PN([ 0,n ]) = [ 2,n ]$ for every $n\ge 2$.
In essence, the intervals $[ 0,n ]\in \PN$ seem to have the most wild factorization behavior.
However, as points are removed from $[ 0,n ]$, one expects a transition to relative tameness as the set of factorizations becomes smaller.
In this chapter, we formulate some additional ways of understanding and quantifying the differences between wild and tame factorization behavior.

%As a first step in leveraging the structure of $\PN$, we introduce some notation to highlight the intuitive grading on subsets of $\NN$.


%One can see that the intervals $[ 0,n ]$ have overwhelmingly many factorizations in $\P_{\fin,0}(\NN)$.
%Any subset of $\NN$ can be obtained by removing points from such an interval, and we know that arbitrary subsets may exhibit all sorts of factorization behavior.  
%As such, it may be interesting to try and observe gradual changes in this behavior as we remove points from $[ 0,n ]$.
%At the opposite extreme of the extremely flexible factorization behavior of $[ 0,n ]$, we have the subsets with the most behavior: the atoms.
%We would like to determine whether there is a distinct threshold for the number of points we are required to remove from $[ 0,n ]$ to obtain an atom.

%The length set realization Theorems \ref{thm:ind-atoms} and \ref{thm:2n-length-set} show that some subsets of $\NN$ have very well-controlled sets of factorization.
%On the other hand, there are subsets with comparatively ``wild" set of factorizations; the intervals $[ 0,n ]$ are a simple class examples which demonstrate this since, for instance, we have $\mathsf{L}([0,n]) = [ 2,n ]$ \cite[Proposition 4.8]{fan-tringali18}.
%However, observe that any subset $X$ can be obtained by deleting points from the interval $[ 0,\max(X) ]$.
%If $X$ has relatively tame factorization behavior and we imagine this process of deleting points from $[ 0,\max(X)]$, then the subsets between the full interval and $X$ experience a transition between ``wild" and ``tame" factorization behavior.
%In what follows, we seek to more rigorously quantify what is meant by ``wild" factorization behavior and to investigate the nature of this transition.

%Since we will be thinking of elements of $\PN$ as subsets of the intervals $[ 0,n ]$, it will be convenient to have some notation to help us filter $\NN$.




%In this section, we wish to develop some tools for making arguments about factorizations of subsets inside an abelian group.  
%We also wish to lay out some practical procedures for the benefit of those who wish to approach power monoids from a computational point of view.

%Throughout this section, we will assume $G$ is an abelian group and that $H\subseteq G$ is a monoid such that, for all $x\in H\setminus\{1\}$, $x^2 \notin\{1,x\}$ (by Theorem \ref{th:atomicity}, this means exactly that $\P_\fon)
%The prototypical example of this situtation is the case when $G = \ZZ^d$ and $H = \NN^d$.
%Unless otherwise specified, all subsets of $H$ instantiated are assumed to be finite and to contain $0$.  That is, they are assumed to be elements of $\P_\fon(H)$.


%First and foremost, we can take advantage of the setting of an abelian group to develop an inductive approach to factorization in $\P_\fon(H)$, when $H$ is a submonoid of an abelian group $G$.

\section{Algorithmic Approaches and Partition Type} \label{sec:algorithms}

In this section, we hope to indicate some practical methods that can be implemented to assist in computational approaches to factorization in $\PN$.
Specifically, we will outline some inductive approaches (i.e., recursive algorithms) for exhaustively finding all factorizations of a subset into atoms.

Consider the following algorithm for finding the prime factorization of an element $n\in \NN$:
\begin{itemize}
	\item For every prime $p \le \sqrt{n}$, check if $p$ divides $n$.
	\begin{itemize}
		\item If no such $p$ divides $n$ then $n$ is a prime; return the factorization $n$.
		\item If some $p$ does divide $n$, find a factorization $\aa$ of $n/p$ and return $p * \aa$.
	\end{itemize}
\end{itemize}
One might wish to imitate this algorithm in $\PN$.
We would begin, for a given $X \in \PN$, whether there is some irreducible $A$ which divides $X$.
If $A$ divides $X$, then there exists some $Y$ with $A + Y = X$; however, since $\PN$ is not cancellative, there is not a unique such $Y$.
This is part of what derails an initial attempt at a factorization algorithm.
%Given $A\in \PN$, we often wish to determine whether $A$ divides $X$; that is, whether there is $Y$ so that $X = A+Y$.
%Due to the non-cancellative nature of power monoids, there is not a canonical choice for such a $Y$.
%In general, there may be many such $Y$.
To make the best of our situation, we have the following definition and proposition. 

\begin{defn} \label{def:cofactor}
	Let $G$ be an abelian group, let $H \subseteq G$ be a monoid, and let $X,A\in \P_{\fin,0}(H)$.
	We define the \textbf{saturated cofactor of $A$ in $X$} by
	\[ X\:A := \bigcap_{a\in A} (X-a) \]
\end{defn}

$X\:A$ is the largest possible set $Y$ such that $X = A + Y$, in the sense of the following proposition.

\begin{prop} \label{prop:cofactors}
	Let $X,A \in \P_\fon(H)$. 
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item $A + X\:A \subseteq X$.
		\item If $X = A + Y$ then $Y \subseteq X\:A$.
		\item If $A$ divides $X$ if and only if $A + X\:A = X$.
	\end{enumerate}
\end{prop}

\begin{proof}
	Point (i) is straightforward to see; suppose $a\in A$ and $x\in X\:A$.
	Then, by construction, $x\in X-a$ so that $x+a \in (X-a) +a = X$.
	
	For (ii), suppose $y\in Y$ and $a\in A$.
	Then $a+y \in A + Y = X$, so $y \in X-a$; this was true for any $a\in A$, so $y\in \bigcap_{a\in A} (X-a) = X\:A$.
	
	To see (iii), first suppose that $A$ divides $X$; then there is some $Y$ so that $A + Y = X$.
	Then, using (ii) and then (i), we have that $X = A+Y \subseteq A+ (X\:A) \subseteq X$, whence all the inclusions are equalities.
\end{proof}

Now, if $A$ divides $X$, $Y := X\:A$ is a somewhat canonical choice satisfying $A + Y = X$.
With this in hand, we can make another attempt at an algorithm for factoring in $\PN$:

\begin{itemize}
	\item For every atom $A \subsetneqq X$, check if $A$ divides $X$ (that is, whether $A + X\:A = X$).
	\begin{itemize}
		\item If no such $A$ divides $X$ then $X$ is an atom; return $X$.
		\item If $A$ divides $X$, return the set $\{A * \aa: \aa\in \Z_{\P_\fon(H)}(X) \}$.
	\end{itemize}
\end{itemize}
This algorithm comes up short since it fails in general to obtain the entire set of factorizations of $X$, as we will see now.

\begin{eg}
	Let $H = \NN$ and take $X := [ 0,n ]$ for some odd $n \ge 11$.
	We can show that $A := \{0,1,3\}$ and $B := \{0,1,3,\dots,n-2,n-3\}$ are both atoms, and that $X = A + B$ (so $A*B$ is a factorization of $X$).
	However, $X\:A = [ 0,n ] \cap [ -1,n-1 ] \cap [ -3,n-3 ] = [ 0,n-3 ] \neq B$ and $X\: B \neq A$.
	Thus the above algorithm will find factorizations of the form $A*\bb$ for $\bb$ a factorization of $[ 0,n-3 ]$ (and similarly $B*\aa$ for $\aa$ a factorization of $[ 0,3 ]$), but it will fail to find $A*B$.
\end{eg} 

This example suggests an adjustment to the algorithm presented just above.

\begin{defn} \label{def:fac algorithm}
	We define the function $\alg{fac}$ which assigns to a given $X$ a set of factorizations of $X$ (which we will later assert is the entire set of factorizations of $X$).
	Given any $X\in \P_\fon(H)$,
	\begin{itemize}
		\item[(1)] Start with $\alg{fac}(X) = \emptyset$.
		\item[(2)] If $X = \{0\}$, return $\alg{fac}(X) = \emptyset$.
		\item[(3)] If $X$ is an atom, return $\alg{fac}(X) = \{X\}$. 
		\item[(4)] For each atom $A \subseteq X$, if $A + X\:A = X$,
		\begin{itemize}
			\item[(5)] For every subset $Y \subseteq X\:A$ with $\max(Y) = \max(X\:A)$, if $A+Y = X$,
			\begin{itemize}
				\item[(6)] For every $\bb\in \alg{fac}(Y)$, add $A*\bb$ to $\alg{fac}(X)$.
			\end{itemize}
		\end{itemize}
		\item[(7)] Return $\alg{fac}(X)$.
	\end{itemize}
\end{defn}

\begin{prop}
	For any $X\in \PN$, $\alg{fac}(X) = \Z_{\PN}(X)$.
\end{prop}

\begin{proof}
We can prove this by inducting on the size of $X$.
If $|X|=1$ then $X = \{1\}$ and $\Z_{\P_\fon(H)}(X) = \emptyset = \alg{fac}(X)$ (in accordance with step (2) in the definition of $\alg{fac}$).
If $|X| = 2$ then, since $H$ is reduced and contains no nontrivial idempotents (as it lies inside $G$), $X$ is an atom by Lemma \ref{lem:2-elt-atoms}.
Hence $\Z_{\P_\fon(H)}(X) = \{X\} = \alg{fac}(X)$ by step (3).
	
It is apparent by construction that $\alg{fac}(X) \subseteq \Z_{\P_\fon(H)}(X)$, so we only need to show that the other inclusion holds.
Suppose $A_1*\cdots*A_k \in \Z_{\P_\fon(H)}$.
Then $A_1 + (A_2 + \cdots + A_k) = X$, so Proposition \ref{prop:cofactors}(iii) implies that $A_1 + (X\:A_1) = X$.
At this point, step (5) of the procedure for generating $\alg{fac}(X)$ will find $Y:=A_2+\cdots+A_k$ in its search of all subsets of $X\:A_1$.
By induction, we have that $A_2*\cdots*A_k \in \Z_{\P_\fon(X)}(Y) = \alg{fac}(Y)$.
Thus $A_1 * \cdots * A_k \in \alg{fac}(X)$, as we wished.
\end{proof}

This algorithm still proceeds by brute force, and can be computationally cumbersome.  
There are several refinements that we can make by taking advantage of the specific situation of factoring inside $\PN$.

\begin{defn} \label{def:filtration}
	For $n\ge 0$, we distinguish the following collections of subsets:
	\begin{align*}
	\P^{(n)} &= \{ X \subseteq [ 0,n ] : 0,n\in X \} \\
	\mathcal{A}^{(n)} &= \mathcal{A}(\PN) \cap \A^{(n)}  \\
	\mathcal{N}^{(n)} &= \P^{(n)} \setminus \mathcal{A}^{(n)} 
	\end{align*}
	%Here we are just filtering the subsets, atoms, and non-atoms (respectively) in accordance with the intuitive grading on subsets of $\NN$.
\end{defn}

\begin{rk}
Note that 
\begin{itemize}
	\item $\PN = \bigsqcup_{n=0}^\infty \P^{(n)}$.
	\item For any $m,n\ge 0$, $\P^{(m)} + \P^{(n)} \subseteq \P^{(m+n)}$.
\end{itemize}
From this we see that the sets $\P^{(n)}$ give a grading of our monoid.
\end{rk}

For any nonunit $x$ in a monoid $H$, the set $\Z_H(x)$ houses the full data of the factorization behavior of $x$. 
Since it is sometimes a tall order to understand all of the information of $\Z_H(x)$ at once, we can consider the set $\mathsf{L}_H(x)$ to gain an incomplete yet often adequate understanding of $\Z_H(x)$.
With the following definition, we aim to leverage the structure of $\PN$ to formulate an invariant which contains more data than the set of lengths.
This will help us in our endeavor to develop a more effecient algorithm for factoring in $\PN$, and also in our larger goal to quanitfy the ``wildness" of factorizations of $[ 0,n]$.

%In any monoid, we can distinguish different factorizations of an element $x$ by their lengths; that is, we know that if $\aa,\bb\in \Z(x)$ with $|\aa| \neq |\bb|$, then $\aa$ and $\bb$ are not equivalent.
%In $\PN$, we have some additional leverage which comes from integer partitions; we make some definitions to facilitate this leverage now.

\begin{defn} \label{def:partition type}
	Let $n\ge 1$. A \textit{partition of $n$} is $P = (m_1,\dots, m_k)$, where $m_1 \ge \dots \ge m_k \ge 1$ and $m_1+\cdots + m_k = n$. 
	Each $m_i$ is said to be a \textit{part} of $P$, and $k$ is said to be the \textit{length} or number of parts of $P$.
	For brevity, we occasionally write $P \vdash n$.
	
	For a factorization $\aa \in \F^*(\A(\PN))$ satisfying $\aa = A_1*\cdots*A_k$ with $\max(A_1)\ge\cdots\ge\max(A_k)$, the \textbf{partition type} of any factorization $\bb\in [\aa]_\simeq$ is $\mathsf{ptype}(\bb) := (\max(A_1),\dots,\max(A_k))$.
	
	In general, for any $X \in \PN$ and for any partition $P = (m_1,\dots, m_k)$ of $\max(X)$, we define the \textbf{set of factorizations of $X$} and \textbf{set of factorization classes of (partition) type $P$} to be
	\[ \Z^P(X) := \{ \aa \in \Z(X) : \mathsf{ptype}(\aa) = P \} \]
	and
	\[\mathsf{Z}^P(X) := \{ [\aa]_\simeq \in \mathsf{Z}(X): \mathsf{ptype}(\aa) = P \},\]
	respectively.
	We also define the \textbf{set of (partition) types of $X$} to be
	\[ \mathsf{T}(X) :=  \{ P \vdash \max(X) : \Z^P(X) \neq \emptyset \}. \]
\end{defn}

Note that, since $\PN$ is reduced, for any factorizations $\aa,\bb\in \F^*(\A(\PN))$, $\aa \simeq \bb$ if and only if $\aa$ and $\bb$ are the same up to reordering of factors.  
This tells us that $\mathsf{ptype}$ as written above is well-defined.

\begin{rk} \label{rk:ptype}
	There are some elementary observations to be made which connect factorization behavior with partition type.
	Say $X \in \PN$ with $n = \max(X)$.
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item $\Z(X) = \bigsqcup_{P} \Z^P(X)$, a disjoint union taken over all partitions $P$ of $n$.
		\item $\Z^{(n)}(X) = \emptyset$ if and only if $X$ is not an atom.
	\end{enumerate}
	Though the disjoint union in (i) is not too hard to see, it is not clear that each $\Z^P(X)$ is nonempty.
	In fact, we will soon see evidence to the contrary in Section \ref{sec:partitions and intervals}.
\end{rk}


To conclude this section, we suggest an outline of another algorithm for calculating sets of factorizations in $\PN$.
In contrast with $\alg{fac}$ from Definition \ref{def:fac algorithm}, this one will proceed constructively rather than inductively.

First define, for $X\in \PN$ and $P = (m_1,\dots,m_k)$ a partition of $\max(X)$, $\alg{fac\_of\_type}(X,P)$ in the following way:
For every $(A_1,\dots,A_k)\in \A^{(m_1)}\times\cdots\times\A^{(m_k)}$, if $A_1 + \cdots + A_k = X$, then add $A_1 * \cdots * A_k$ to $\alg{fac\_of\_type}(X,P)$.

After this, we can define a new function, $\alg{fac\_by\_type}(X)$.
The end result is an algorithm of the following form:
\begin{itemize}
	\item[(1)] Start with $\alg{fac\_by\_type}(X) = \emptyset$.
	\item[(2)] For each partition $P=(m_1,\dots, m_k)$ of $\max(X)$, if $\{0,m_1\}+\cdots+\{0,m_k\} \subseteq X$,
	\begin{itemize}
		\item[(3)] Add $\alg{facs_\_of\_type}(X,P)$ to $\alg{fac\_by\_type}(P)$.
	\end{itemize}
	\item[(4)] Return $\alg{fac\_by\_type}(X)$.
\end{itemize}

Though this procedure for generating $\mathsf{fac\_by\_type}(X)$ still relies on brute force, it does work fast relative to $\alg{fac}$---especially for ``small" subsets $X\subseteq \NN$.
It requires that one computes the sets $\A^{(m)}$ for $m<\max(X)$, which is a computational endeavor in its own right.
However, calculating and recording the elements of $\A^{(m)}$ a single time compares favorably with $\alg{fac}$, as $\alg{fac}$ essentially requires the calculation of all atoms which are subsets of the input set $X$ each time the algorithm is used.
It also affords some opportunities for avoiding unnecessary calculations; for instance, step (2) identifies which partition types are feasible by examining the subsums $\Sigma(P)$ of $P$.
We will have more to say about subsums in Section \ref{sec:subsums}.



\section{Admissible and Forbidden Types for Intervals} \label{sec:partitions and intervals}
%%%%%%
%%%%%%


%Here, we have demonstrated that each $\Z^P([ 0,n ])$ is nonempty when $\min(P) = 1$.  
%However, as with other aspects of the set of factorizations of $[ 0,n ]$, we hope this indicates that intervals have \textit{many} factorizations of each such type $P$.
%On the other hand, some types can never admit factorizations; we shall see some examples of this soon.

As alluded to in Remark \ref{rk:ptype}, it is not always clear for which $P$ is $\Z^P(X) \neq \emptyset$ for a given $X$.
In this section we fully address this question in the case when $X = [0,n]$ is an interval.


\begin{prop} \label{prop:2-elt factor/cofactor}
	Let $X\in \PN$.
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item Let $n = \max(X) + b$. $X + \{0,b\} = [ 0,n ]$ if and only if $X \cap \{k,k-b\} \neq \emptyset$ for every $k\in [ 0,n ]$.
		\item For any $c\ge 1$, $X + \{0,2c\} = [ 0,\max(X)+2c ]$ implies that $\{0,c\}$ divides $X$.
	\end{enumerate}
\end{prop}

\begin{proof}
	For (i), we first prove the ``only if" direction.  
	Suppose $k\in [ 0,n ]$; then $k\in X + \{0,b\}$.
	We must have that $k\in X + 0$ or that $k \in X + b$, which is the same as saying $k\in X$ or $k-b\in X$.
	
	Conversely, suppose that $k\in [ 0,n ]$.
	If $k\in X \subseteq X + \{0,b\}$, we are done.
	If $k\notin X$, then we have by assumption that $k-b\in X$, meaning $k\in X +b \subseteq X+ \{0,b\}$.
	We conclude that $X + \{0,b\} \supseteq [ 0,n ]$, and the other inclusion is clear since $\max(X+\{0,b\}) = \max(X) + b = n$.
	
	For (ii), we use Proposition \ref{prop:cofactors}.
	Let $Y = X\:\{0,c\} = X\cap (X-c)$; we know that $\{0,c\} + Y \subseteq X$, so we just need to show the other inclusion.
	Suppose $X \supsetneqq \{0,c\} + Y$; then there is $x\in X$ with $x\notin \{0,c\} + Y$.
	This means that $x\notin X \cap (X-c)$ and $x \notin X \cap (X-c)$; all together, this means $x+c,x-c\notin X$.
	However, this contradicts part (i), taking $b = 2c$ and $k = x+c$.
	Thus we must have $X = \{0,c\} + X\:\{0,c\}$.
\end{proof}

\begin{prop} \label{prop:bad types}
	Let $n\ge 1$.
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item For $n\ge 4$, $\Z^{(n-2,2)}([ 0,n ]) = \emptyset$.
		\item For even $n\ge 4$, $\Z^{(2,\dots,2)}([ 0,n ]) = \emptyset$.
		\item For odd $n\ge 5$, $\Z^{(3,2,\dots, 2)}([ 0,n ]) = \emptyset$.
		\item For even $n\ge 6$, $\Z^{(4,2,\dots, 2)}([ 0,n ]) = \emptyset$.
		\item For odd $n\ge 7$, $\Z^{(5,2,\dots, 2)}([ 0,n ]) = \emptyset$.
	\end{enumerate}
\end{prop}
\begin{proof}
	For (i), we can use the second part of Lemma \ref{prop:2-elt factor/cofactor} with $c = 1$ to see that there can be no atom $A$ with $A+\{0,2\} = [ 0,n ]$.
	
	It is easy to see (ii) because $\{0,2\}$ is the only atom in $\mathcal{A}^{(2)}$, and no sum of the form $\{0,2\} +\dots +\{0,2\}$ can contain $1$, let alone a whole interval.
	
	For (iii), write $n = 2m+1$.
	We note that $\mathcal{A}^{(3)} = \{\{0,2,3\}, \{0,1,3\} \}$.
	Since $1$ belongs to the interval, if $[ 0,2m+1 ]$ is to have a factorization of partition type $(3,2,\dots,2)$, then that factorization must include $\{0,1,3\}$.
	However, we see that 
	\[ \{0,1,3\} + (m-1)\{0,2\}  = \{0,1,3\} + \{0,2,\dots, 2m-2\} = [ 0, 2m-1 ] \cup \{2m+1\} \]
	which does not contain $2m = n-1$, so $[ 0,2m+1]$ cannot have a factorization of type $(3,2,\dots,2)$.
	
	The arguments for the remaining parts proceed along similar lines.
	For (iv), we note that the only atoms in $\mathcal{A}^{(4)}$ which contain $1$ are $\{0,1,4\}$ and $\{0,1,2,4\}$.
	However, if $n = 2m$, we have
	\[ \{0,1,2,4\} + (m-2)\{0,2\} = \{0,1,4\} + \{0,2,\dots, 2m-4\} = [ 0, 2m-2 ] \cup \{2m\} \]
	which again fails to contain $n-1$.
	
	Finally, we turn to (v).
	We similarly begin by observing that the only atoms in $\mathcal{A}^{(5)}$ which contain $1$ are $\{0,1,5\}$, $\{0,1,2,5\}$, and $\{0,1,3,5\}$.
	Let $n = 2m+1$.
	By calculations similar to those above, one can see that $n-2 \notin \{0,1,2,5\} +(m-2)\{0,2\}$ and $n-1\notin \{0,1,3,5\} + (m-2)\{0,2\}$.
\end{proof}

%%%%%%
%%%%%%
%%%%%%
%%%%%%

As we have just seen above, several partition types fail to appear because of the limited number of atoms available in $\mathcal{A}^{(N)}$ for small $N$.
Even in $\mathcal{A}^{(5)}$, where there are a few choices of atoms containing $1$, there is no atom which contains both $1$ as well as enough ``comparably larger'' elements closer to $5$.
However, this issue does not seem to arise for atoms with larger maximum; indeed, in $\mathcal{A}^{(7)}$ we have several choices which fit this requirement: for example, $\{0, 1, 2, 4, 6, 7\}$, and $\{0, 1, 3, 5, 6, 7\}$ seem promising if one hopes to produce factorizations of type $(7,2,\dots, 2)$. 
Indeed, the problems that occur for atoms of sizes between $2$ and $5$ do not persist, for we have the following.

Our goal now will be to verify that intervals have factorizations of various partition types.  
To aid in this, we will need a few classes of specifically structured ``large atoms" to populate the sets $\mathcal{A}^{(N)}$.

\begin{prop} \label{prop:2-congruence atoms}
	Each of the following sets is an atom of $\PN$ for the given values of the parameter $h$.
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item $B_{2h-1} := \{0,1,3,\dots, 2h-1\}$ for $h\ge 1$.
		\item $B_{2h} := \{0,1,3,\dots, 2h-1,2h\}$ for $h \ge 3$.
		\item $C_{2h} := \{0,2,4,\dots,2h\}\cup\{1\}$ for $h\ge 2$.
		\item $C_{2h+1} := \{0,2,4,\dots, 2h\}\cup\{1,2h+1\}$ for $h\ge 3$.
	\end{enumerate}
\end{prop}

\begin{proof}
	One who has read ahead will realize that, for $h > 5$, each of these is an instance of a \textit{residually concentrated atom} as defined and explored in Chapter \ref{ch:intervals}.  
	The proof is then finished by citing Proposition \ref{prop:resid concentrated atoms} and applying one of the algorithms from Section \ref{sec:algorithms} to handle the comparatively cases when $h\le 5$.
	However, we will also give a direct proof which has the benefit of giving insight into the way in which these atoms were constructed, and into how one might generally argue about factorizations in $\PN$.
	
	Beginning with (i), we suppose that there are $X,Y\in \PN$ so that $B_{2h-1} = X + Y$.
	Without loss of generality, $1\in X$.
	Then $Y\subseteq B_{2h-1}$ cannot contain any nonzero elements; if $y\in Y\setminus\{0\}$ then $1+y\in B_{2h-1}$ is even, a contradiction.
	Thus $Y = \{0\}$ and $B_{2h-1}$ is an atom.
	
	For (ii), we start similarly by assuming that $B_{2h} = X + Y$ and that $1\in X$.
	If $y\in Y \setminus\{0\}$, then $1+y\in B_{2h}$ is even, meaning that $y = 2h-1$.
	We now have that $Y = \{0\}$ or $Y = \{0,2h-1\}$.
	In the first case, we are done; but we are nearly done in the second case as well.  
	Since $\max(X) + \max(Y) = 2h$, it must be that $X = \{0,1\}$, so $B_{2h} = X+Y = \{0,1\} + \{0,2h-1\} = \{0,1,2h-1,2h\}$.
	However, this is impossible since we have assumed that $h\ge 3$.
	
	Turning to (iii), suppose that $C_{2h} = X + Y$ and that $1\in X$.
	We know that if $Y$ has a nonzero even element then $C_{2h} = X + Y$ contains the odd element $y+1 > 1$.
	Thus $Y \subseteq \{0,1\}$; but then $C_{2h} \subseteq \{0,1\} + \{0,1\} = \{0,1,2\}$, which is incompatible with the assumption that $h\ge 2$.
	
	Finally, for (iv), let $X$ and $Y$ be subsets such that $C_{2h+1} = X + Y$, and say $1\in X$.
	Similarly to (iii), we see that $Y$ can have no nonzero even elements $y$ \textit{unless} $y=2h$.
	This means that the only possibilities are $Y = \{0\}$ (in which case we are done), $Y = \{0,1\}$, or $\max(Y) = 2h$.
	These last two cases are symmetric, so suppose $\max(Y) = 2h$.
	Then $X = \{0,1\}$ and $Y \subseteq \{0,1,2h\}$, so $C_{2h+1} \subseteq \{0,1\} + \{0,1,2h\} = \{0,1,2,2h,2h+1\}$.
	This last inequality is seen to be infeasible by recalling that $h\ge 3$.
\end{proof}

We will see that the above constructions are helpful because sums of small numbers of these atoms will be able to form relatively large intervals.

\begin{lemma} \label{lem:two-part types}
	If $q\ge r \ge 3$ then $[ 0, q+r ] \in \A^{(q)} + \A^{(r)}$; 
	that is, there are atoms $A_q\in \A^{(q)}$ and $A'_r\in \A^{(q)}$ such that $A_q + A'_r = [ 0,q+r ]$.
\end{lemma}

\begin{proof}
	There are several cases to consider; roughly, these amount to when both, one of, or none of $q$ and $r$ is large.
	
	\underline{Case 1}: $q,r \ge 6$. 
	
	\underline{Subcase 1.a}: $q = 2s$ and $r = 2t+1$.
	Then 
	\begin{align*}
	B_{2s} + C_{2t+1} 
	&\supseteq \{0,1\}\cup\{2s-1,2s\} + \{0,1,2,4,\dots, ,2t,2t+1\} \\
	&= [ 0, 2t+2 ] \cup [ 2s-1,2s+2t+1 ]
	\end{align*}
	and, switching the roles of $s$ and $t$ in the calculation we just saw, we also have 
	\[B_{2s}+C_{2t+1} \supseteq [ 0,2s+1 ] \cup [ 2t,2s+2t+1 ].\]
	Thus we conclude that $[ 0,2s+2t+1 ] \subseteq B_{2s}+C_{2t+1} \subseteq [ 0,2s+2t+1 ]$ and so $B_r + C_q = [ 0,q+r ]$.
	
	\underline{Subcase 1.b}: $q = 2s+1$ and $r = 2t$.
	Because the above computation does not depend on which of $q$ and $r$ is smaller, we may recycle that argument to see that $C_q + B_r = [ 0,q+r ]$.
	
	\underline{Subcase 1.c}: $q = 2s+1$ and $r = 2t+1$.\\
	One can show that $C_q + C_r = [ 0,q+r ]$ by a calculation similar to the one above.
	
	\underline{Subcase 1.d}: $q = 2s$ and $r = 2t+1$. \\
	Again, similar methods will tell us that $B_q + C_r = [ 0,q+r ]$.
	
	\underline{Case 2}: $3 \le r \le 5 < q$.\\
	There are only a few possibilities here.
	Let $A_3 = \{0,1,3\}$, $A_4 = \{0,2,3,4\}$, and $A_5 = \{0,2,4,5\}$; then we can see that $B_q +A_r = [ 0,q+r ]$ when $q$ is even and $C_q + A_r = [ 0,q+r ]$ when $q$ is odd.
	
	\underline{Case 3}: $3\le r\le q \le 5$.\\
	This leaves only a handful of $(q,r)$ pairs to check; namely $(3,3)$, $(4,3)$, $(5,3)$, $(4,4)$, $(5,4)$, and $(5,5)$.
	By judicious choice of atoms like $A_3$, $A_4$, and $A_5$ in the previous case, the result can be realized for each of these pairs.
\end{proof}

\begin{prop} \label{prop:3-congruence atoms}
	For $h\ge 2$, each of the following subsets of $\NN$ is an atom in $\PN$:
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item $D_{3h} := \{0,3,6,\dots, 3h\} \cup \{ 1, 3h-1 \}$.
		\item $D_{3h+1} := \{0,3,6,\dots, 3h\} \cup \{ 1, 3h+1 \}$.
		\item $D_{3h+1} := \{0,3,6,\dots, 3h\} \cup \{ 1, 3h+1, 3h+2 \}$.
	\end{enumerate}
\end{prop}

\begin{proof}
	As in the proof of Proposition \ref{prop:2-congruence atoms}, we note that these sets may be verified to be atoms by applying Proposition \ref{prop:resid concentrated atoms}.
	Yet we will, once again, outline a more direct argument for the sake of clarity.
	
	The arguments for each are similar, but (i) and (ii) are comparatively easier than (iii), so we will just prove (iii).
	Suppose that there are $X$ and $Y$ so that $D_{3h+2} = X + Y$.
	We may freely suppose that $1\in X$ this implies that $Y \subseteq \{0,3h,3h+1\}$.
	We cannot have $\max(Y) = 3h$, for then $\max(X) = 3h+2 - \max(Y) = 2$.
	This is impossible since $2\notin D_{3h+2}$.
	
	If $\max(Y) = 3h+1$ then $X = \{0,1\}$, so $D_{3h+2} \subseteq \{0,1\} + \{0,3h,3h+1\} = \{0,1,3h,3h+1,3h+2\}$.
	However, this cannot be the case since $3,6\in D_{3h+2}$.
	The only remaining possibility is that $Y = \{0\}$, which implies that $D_{3h+2}$ is an atom, as we wished.
\end{proof}

These atoms will help us obtain more decompositions of intervals, with the following rough justification: we know that $3\NN + 2\NN = \NN \setminus\{1\}$. 
We hope to mimic this for finite subsets by adding a truncated (and slightly modified) copy of $3\NN$ to a truncated copy of $2\NN$.
To make this precise, we have the following lemma.

\begin{lemma} \label{lemma:many 2s types}
	For $q \ge 6$ and $t\ge 2$, there is an atom $A\in \A^{(q)}$ with $A + t\{0,2\} = [ 0, q+2t ]$.
\end{lemma}

\begin{proof}
	This essentially depends on the congruence class of $q$ modulo $6$.
	In the spirit of the argument from the preceding proposition, we demonstrate the result for the most representatively difficult of these cases.
	
	Suppose $q \equiv 0 \mod 6$, so $q = 3h$ for some even $h$.
	We first note that
	\begin{align*}
	D_{3h} + t\{0,2\} 
	&\supseteq \{0,6,\dots, 3h\} + \{0,2,4,\dots, 2t\} \\
	& = \{0,2,4,\dots, 3h+2t \}
	\end{align*}
	and similarly that
	\begin{align*}
	D_{3h} + t\{0,2\}
	&\supseteq \{3,9,\dots, 3(h-1) \}\cup\{1,3h-1\} + \{0,2,4,\dots, 2t \} \\
	&= \{3,5,\dots, 3h-3 + 2t \}\cup \{1,3h-1 + 2t \} \\
	&= \{1,3,5,\dots, 3h+2t-1 \}
	\end{align*}
	Putting these together, we see that $D_{3h} + t\{0,2\} = [ 0,3h+2t ]$.
\end{proof}

\begin{rk}
	The most important details that make this argument work are
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item $1,q-1\in D_q$
		\item $\{0,2,4\} \subseteq t\{0,2\}$
	\end{enumerate}
	Point (i) enables us to ``perturb" $t\{0,2\}$ in a way which ensures that the points near the ends of the desired interval are included.
	Point (ii) is significant because it allows us to include the middle portion of the interval by covering it with ``patches" of length $6$.
	This is also a comforting constraint in light of Proposition \ref{prop:bad types}, which says that $D_q + \{0,2\}$ cannot be an interval since $D_q$ is an atom.
\end{rk}


\begin{thm} \label{thm:good types}
	Let $n\ge 1$ and suppose $P$ is a partition of $n$ with $P \notin \{(n-2,2)\} \cup \{ (m,2\dots,2) : 2\le m \le 5\}$.
	Then $\Z^P([ 0,n ]) \neq \emptyset$.
	In particular, for $n\ge 8$, $|\mathsf{T}([ 0,n ])| = p(n)-4$, where $p(n)$ is the number of integer partitions of $n$.
\end{thm}

\begin{proof}
	It is helpful to first classify the ways in which $P$ can avoid being a partition not of the types prescribed above.  
	We have several possibilities.
	
	
	\underline{Case 1}: $P = (q,2,\dots, 2)$ with $m\ge 6$.
	
	Here, Lemma \ref{lemma:many 2s types} implies that $\Z^P([ 0,n ]) \neq \emptyset$.
	
	\underline{Case 2}: $P$ has two parts, both of which are larger than $2$.
	
	The content of Lemma \ref{lem:two-part types} is exactly that $\Z^P([ 0,n ]) \neq \emptyset$ for any such partition.
	
	\underline{Case 3}: $P = (m_1,\dots, m_k)$ with $k\ge 3$ and $m_1\ge m_2 \ge 3$.
	
	To resolve this possibility, we proceed by induction.
	The constraints on $P$ imply that $n\ge 8$.  
	Enumerating the factorizations of $[ 0,8 ]$ by hand (or, preferably, by computer) is not prohibitively difficult and indeed confirms that $[ 0,8 ]$ has factorizations of every type other than those excluded in the statement of the theorem.
	
	Suppose now that $n > 8$ and, for $8\le m < n$, $[ 0,m ]$ has factorizations of each type fitting the description in (iii).
	Consider $P' = (m_1,\dots, m_{k-1})$.
	If $k=3$ then $P'=(m_1,m_2)$ is a partition of $n-m_k$ as described in case 2, and if $k>3$ then $P'$ is as in case 3.  
	In any event, either by the result from case 2 or by our inductive assumption, we know that $\Z^{P'}([ 0,n-m_k ]) \neq \emptyset$.
	Taking $\aa' \in \Z^{P'}([ 0,n-m_k ])$, we have that $\aa := \aa' * \{0,m_k\} \in \Z^P([ 0,n ])$.
	
	\underline{Case 4}: $P$ has smallest part equal to $1$.
	
	Finally, we have the partitions described in (iv): those with smallest part equal to 1.
	The result is reasonable to check by hand for $n=1,2,3$.
	We proceed by induction on $n$, assuming that $n>3$ and that the proposition is true for $m<n$.
	Let us write $P = (m_1,\dots, m_k, 1)$.
	
	If $k=1$, we can see that $C_{n-1}*\{0,1\}\in \Z^P([ 0,n ])$, where $C_{n-1}$ is one of the atoms constructed in Proposition \ref{prop:2-congruence atoms}.
	Similarly, if $k=2$ we have by Lemma \ref{lem:two-part types} that there are atoms $A\in \A^{(m_1)}$ and $A'\in \A^{(m_2)}$ with $A+A' = [ 0,m_1+m_2 ]$, so $A*A'* \{0,1\}\in \Z^P([ 0,n ])$.
	
	Now assume that $k>2$ and write $P' = (m_1,\dots, m_k)$.
	If $m_k=1$, then there is some $\aa'\in \Z^{P'}([ 0,n-1 ])$ by induction, so that $\aa = \aa' * \{0,1\}\in \Z^P([ 0,n ])$.
	However, if $m_k > 1$, set $Q = (m_1,\dots, m_{k-1}, 1)$ (a partition of $n-m_k$).
	Again, we have by induction that there is some $\bb \in \Z^Q([ 0, n-m_k ])$.
	Since $k>2$ and $m_k \le m_i$ for all $i\ge 1$, we also have that $m_k < n/2$ and so $n-m_k > m_k$.
	This allows us to conclude that $\aa = \bb * \{0,m_k\} \in \Z^P([ 0,n ])$, proving what we wished.
\end{proof}

\section{Subsums and Non-Intervals} \label{sec:subsums}
We have just seen that intervals of the form $[ 0,n ]$ have factorizations of most partition types.
There is a very sharp dichotomy between the wildly varied factorization behavior of intervals and that of any other subset of $\NN$, which we will see presently.  

We have just seen that intervals of the form $[0,n]$ have factorizations of almost every partition type.
However, this section will demonstrate that non-intervals a very far from satisfying this sort of behavior.
This helps us begin to distinguish intervals from the rest of $\PN$ in a quantifiable way.  

\begin{defn}
Let $m_1,\dots, m_k$ be integers.
We will refer to $S = (m_1,\dots, m_k)$ as a \textit{sequence} of integers.
Define the \textbf{set of subsums of S} to be $\Sigma(S) := \left\{ \sum_{i\in I} m_i : I\subseteq [ 1,k ] \right\}$.
\end{defn}

\begin{rk}
The notion of ``set of subsums" of a sequence can be compared with the similar notion which appears in much of the literature on zero-sum problems in finite abelian groups; see \cite[Definition 5.1.1]{geroldinger-hk06} or many papers on zero-sum problems for similar notation in a different context. 
Our definition is nearly identical, except for its inclusion of the empty sum.
Since we are not focused on the appearance of zero sums, including the empty sum does not put us at any disadvantage in our setting.
To the contrary, it is convenient for us as it allows us to express the set of subsums of $S = (m_1,\dots, m_k)$ as a sum in $\P_\fon(\ZZ)$: $\Sigma(S)  = \{0,m_1\} + \cdots +\{0,m_k\}$.
\end{rk}

\begin{lemma} \label{lem:long-partitions}
Let $m_1,\dots, m_k$ be positive integers with $m_1\ge \cdots \ge m_k \ge 1$ and let $n = m_1 + \cdots + m_k$.
If $k> n/2$ then $\Sigma(m_1,\dots, m_k) = [ 0,n ]$.
\end{lemma}

\begin{proof}
To prove this, we will induct on $k$; if $k=1 > n/2$, then $n \le 1$ and the result is trivial.
Now suppose $k > 1$ and that, for any sequence $T$ consisting of $\ell < k$ terms satisfying $\ell > \max(\Sigma(T))/2$, $\Sigma(T) = [ 0, \max(\Sigma(T)) ]$.
	
First observe that the maximum term of $S$ is at least the average of the terms of $S$; that is, $m_1 \ge \frac{n}{k}$.
From here, we have
\[ \frac{m_2+\cdots + m_k}{k-1} = \frac{n-m_1}{k-1} \le \frac{n-n/k}{k-1} = \frac{n}{k} < 2 \]
Thus $k - 1 > \frac{m_2+\cdots+m_k}{2}$ and we can apply the inductive hypothesis to $T := (m_2,\dots, m_k)$.
Now we have $\Sigma(T) = [ 0, n-m_1 ]$, so $\Sigma(S) = \{0,m_1\} + [ 0,n-m_1 ] = [ 0,n-m_1 ] \cup [ m_1,n ]$.
This union of intervals is equal to $[ 0,n ]$ if $m_1 \le m_2 + \cdots + m_k +1$, so all that remains is to verify this last inequality.
	
From our assumption that $k > n/2$, we have $k-1 \ge (n-1)/2$, so 
\[m_2 + \cdots + m_k \ge 1 +\cdots + 1 = k-1 \ge \frac{n-1}{2}.\]
Using this inequality twice, we have that
\[m_1 = n - (m_2 + \cdots + m_k) \le n - \frac{n-1}{2} = \frac{n+1}{2} \le m_2 + \cdots + m_k + 1,\]
exactly as we wished.
\end{proof}

\begin{lemma} \label{lem:n/2-partitions}
Let $n$ be even and let $P$ be a partition into $n/2$ parts.
Then one of the following holds:
\begin{itemize}
	\item $\Sigma(P) = [ 0, n ]$.
	\item $\Sigma(P) = [ 0,n ]\setminus\{n/2\}$ and $P = (n/2+1,1,\dots,1)$.
	\item $\Sigma(P) = 2\cdot [ 0, n/2 ]$ and $P = (2,\dots, 2)$
\end{itemize}
\end{lemma}

\begin{proof}
Let $P = (m_1,\dots, m_k)$ with $k=n/2$ and $m_1\ge \cdots \ge m_k \ge 1$.
Note that the average size of the parts of $P$ is $(m_1+\cdots+m_k)/k = n/(n/2) = 2$.
Thus the smallest part $m_k$ satisfies $m_k \le 2$.
	
If $m_k = 2$ then $m_1 = n - (m_2+\cdots+m_k) \le n - (k-1)(2) = n - (n/2-1)2 = 2$.
Thus we have $m_1 = \cdots = m_k = 2$ and so $\Sigma(P) = \{0,2\}+\cdots+\{0,2\} = \{0,2,\dots,n\} = 2\cdot[0,n/2]$ (recalling that $2\cdot X = \{2x: x\in X\}$, as opposed to $2X = X+X$).
	
Suppose now that $m_k=1$.
Then, since the average of the parts $m_i$ is equal to $2$, we must have that the greatest part $m_1 > 2$.
As a result, 
\[\frac{m_2+\cdots+m_k}{k-1} = \frac{n-m_1}{n/2-1} < \frac{n-2}{n/2-1} = 2, \]
so $k-1 > (m_2 + \cdots + m_k)/2$; by Lemma \ref{lem:long-partitions}, $\Sigma(m-2,\dots,m_k) = [ 0, n-m_1 ]$.
	
Now we have $\Sigma(P) = \{0,m_1\} + [ 0,n-m_1] = [ 0,n-m_1 ] \cup [ m_1, n]$, so $\Sigma(P) = [ 0,n ]$ provided $2m_1 < n+1$.
If not, then $2m_1 \ge n+2$, so $m_1 \ge \frac{n+2}{2}$.
From this, it follows that 
\[m_2 +\cdots+m_k = n-m_1 \le n - \frac{n+2}{2} = \frac{n}{2}-1 = k-1.\]
Since each $m_i \ge 1$, we must have $m_2 = \cdots = m_k = 1$, so $P = (n/2+1, 1,\dots, 1)$ and $\Sigma(P) = [ 0,n/2-1 ] \cup [ n/2+1,n]$.
\end{proof}

\begin{thm} \label{thm:long factorization implies interval}
Let $X \in \PN$ and say $n := \max(X)$.
\begin{enumerate}[{label=(\roman{*})}]
	\item If there is $k\in \mathsf{L}(X)$ with $k>n/2$ then $X = [0,n]$
	\item If $n/2\in \mathsf{L}(X)$ then $X = [0,n]$, $X=[0,n]\setminus\{n/2\}$, or $X = (n/2)\cdot \{0,2\}$
\end{enumerate}
%and suppose that there is $k\in \mathsf{L}(X)$ with $k > \max(X)/2$.
%Then $X = [ 0, \max(X) ]$.
\end{thm}

\begin{proof}
Begin with (i): let $n = \max(X)$ and let $\aa\in\Z(X)$ be a factorization with length $|\aa| = k$.
Then there are integers $m_1\ge\cdots \ge m_k \ge 1$ and atoms $A_i\in \A^{(m_i)}$ with $\aa = A_1*\cdots*A_k$.
The result is immediate from Lemma \ref{lem:long-partitions}, since we have
\[ X = A_1 + \cdots + A_k \supseteq \{0,m_1\} + \cdots + \{0,m_k\} = \Sigma(m_1,\cdots,m_k) = [ 0,n ] \]
and we know $X \subseteq [ 0,\max(X) ] = [ 0, n ]$.

The argument for (ii) is identical, except we instead use Lemma \ref{lem:n/2-partitions}.
\end{proof}

\begin{cor}
If $X\in \PN$ and $X$ is not an interval or an atom, then $\mathsf{L}(X) \subseteq [2,\max(X)/2]$.
In particular, $X$ has no factorizations of partition type $P$ for any $P$ with $|P| > \max(X)/2$.
\end{cor}

\begin{proof}
This is immediate, as it is the contrapositive of Theorem \ref{thm:long factorization implies interval}.
\end{proof}
