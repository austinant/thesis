\chapter{Power Monoids and Atomicity} \label{ch:power monoids}

Here we embark on the study of the (arithmetic and algebraic) structure of power monoids.
These objects were first introduced and studied by Y. Fan and S. Tringali in \cite{fan-tringali18}.
They encode a very natural combinatorial construction: the collection of finite subsets of a monoid.  
Historically, combinatorial thinkers have been concerned primarily with subsets of abelian groups, or even just cycic groups.  
Throughout the remainder of this work, we will see that the prior concentration of the literature on the case of abelian groups has been well-founded: 
this is a very tractible and robust area of research, with many questions which are yet unanswered.
However, we will also see that the phenomena which occur in subsets of more general monoids present vast challenges of their own, and are certainly deserving of attention.

\section{Subset Arithmetic} \label{sec:pm basics}

\begin{defn} \label{def:power monoid}
	Let $(H,\cdot)$ be a monoid.
	We define an operation (called \textit{setwise} $\cdot$) by, for any subsets $X,Y\subseteq H$,
	\[X\cdot Y := \{x\cdot y: x\in X \textrm{ and } y\in Y\} \]
	(as before, we will usually drop the ``$\cdot$'' and simply write $XY$ for $X\cdot Y$).
	With this operation, the following collections of subsets of $H$ become monoids:
\begin{itemize}
	\item The \textit{power monoid} of $H$ is $\P_\fin(H) := \{X\subseteq H: X\neq\emptyset \textrm{ and } |X|<\infty \}$;
	\item The \textit{restricted power monoid} of $H$ is $\P_\funt(H) := \{X\subseteq H: X\cap H^\times \neq \emptyset \textrm{ and } |X|<\infty\}$;
	\item The \textit{reduced power monoid} of $H$ is $\P_\fun(H) := \{X\subseteq H: 1_H\in X \textrm{ and } |X|<\infty\}$.
\end{itemize}
	We may refer to $H$ as the \textit{ground monoid} of any of these power monoids.
\end{defn}

We proceed first with some elementary but helpful observations we will often use without comment.

\begin{prop}\label{prop:pm-arith}
	Let $H$ be a monoid. The following hold:
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item\label{it:prop:pm-arith(i)} If $X_1,\ldots,X_n\in \P_{\fin,1}(H)$, then $X_1 \cup \cdots \cup X_n \subseteq X_1 \cdots X_n$.
		%
		\item\label{it:prop:pm-arith(ii)} If $u,v \in H^\times$ and $X_1,\ldots,X_n\in \P_{\fin,\times}(H)$, then $|uX_1 \cdots X_nv| = |X_1 \cdots X_n| \ge \max_{1 \le i \le n} |X_i|$.
		%
		\item\label{it:prop:pm-arith(iii)} If $K$ is a submonoid of $H$, then $\P_\fun(K)$ is a divisor-closed submonoid of $\P_\fun(H)$. \textup{(}Note that the conclusion is valid regardless of whether $K$ itself is divisor-closed.\textup{)}
		%
		\item \label{it:prop:pm-arith(iv)} $\P_\fun(H)$ is a reduced monoid and $\P_\fin(H)^\times=\P_\funt(H)^\times = \bigl\{ \{u\}: u\in H^\times\bigr\}$.
		\item \label{it:prop:pm-arith(v)} $\A(\mathcal P_{\funt}(H)) \subseteq H^\times \A(\mathcal P_{\fun}(H)) H^\times$.
	\end{enumerate}
\end{prop}
%
\begin{proof}
	\ref{it:prop:pm-arith(i)} is trivial, upon considering that $(X \cdot 1_H) \cup (1_H \cdot Y) \subseteq XY$ for all $X, Y \in \mathcal P_\fun(H)$; \ref{it:prop:pm-arith(ii)} is a direct consequence of \ref{it:prop:pm-arith(i)} and the fact that the function $X \to H: x \mapsto uxv$ is injective for all $u, v \in H^\times$ and $X \subseteq H$; and \ref{it:prop:pm-arith(iii)} and \ref{it:prop:pm-arith(iv)} are immediate from \ref{it:prop:pm-arith(i)} and \ref{it:prop:pm-arith(ii)}.
	
	As for \ref{it:prop:pm-arith(v)}, let $A\in \A(\P_\funt(H))$.
	Because $A$ contains a unit of $H$, there is $u\in H^\times$ such that $1_H \in uA$.
	Then $uA$ is an element of $\P_\fun(H)$, and by Proposition \ref{prop:unit-adjust}\ref{it:prop:unit-adjust(i)} it is also an atom of $\P_\funt(H)$.
	Thus, if $X,Y\in \P_\fun(H) \subseteq \P_\funt(H)$ and $uA = XY$, then $X$ or $Y$ is the identity of $\P_\fun(H)$.
	This means that $uA$ is an atom of $\P_\fun(H)$, and hence $A=u^{-1}(uA)\in H^\times \A(\P_\fun(H))$, as wished.
\end{proof}

Our ultimate goal is, for an arbitrary monoid $H$, to investigate factorizations in $\P_\fin(H)$. However, this is a difficult task in general, due to a variety of ``pathological situations'' that might be hard to classify in a satisfactory way, see e.g. \cite[Remark 3.3(ii)]{fan-tringali18}.

In practice, it is more convenient to start with $\P_\fun(H)$ and then lift arithmetic results from $\P_\fun(H)$ to $\P_\funt(H)$, a point of view which is corroborated by the simple consideration that $\P_\fin(H) = \P_\funt(H)$ whenever $H$ is a group (i.e., in the case of greatest interest in Arithmetic Combinatorics).

In turn, we will see that studying the arithmetic of $\P_\funt(H)$ is tantamount to studying that of $\P_\fun(H)$, in a sense to be made precise presently.

\begin{prop}\label{prop:funt&fun-have-the-same-system-of-lengths}
	Let $H$ be a Dedekind-finite monoid. The following hold:
	%
	\begin{enumerate}[label={\rm (\roman{*})}]
	\item\label{it:prop:funt&fun-have-the-same-system-of-lengths(i)} The natural embedding $\jmath: \P_\fun(H)\hookrightarrow \P_\funt(H)$ is an essentially surjective equimorphism.
	%
	\item\label{it:prop:funt&fun-have-the-same-system-of-lengths(ii)} $\A(\mathcal P_{\funt}(H)) = H^\times \A(\mathcal P_{\fun}(H)) H^\times$.
	%
	\item\label{it:prop:funt&fun-have-the-same-system-of-lengths(iii)} $\mathsf{L}_{\mathcal P_{\fun}(H)}(X) = \mathsf{L}_{\mathcal P_{\funt}(H)}(X)$ for every $X \in \mathcal P_{\fun}(H)$.
	%
	\item\label{it:prop:funt&fun-have-the-same-system-of-lengths(iv)} $\mathcal{L}(\mathcal P_{\funt}(H)) = \mathcal{L}(\mathcal P_{\fun}(H))$.
	\end{enumerate}
\end{prop}
%
\begin{proof}
	%	
	In view of Proposition \ref{prop:equimorphism}, parts \ref{it:prop:funt&fun-have-the-same-system-of-lengths(iii)} and \ref{it:prop:funt&fun-have-the-same-system-of-lengths(iv)} are immediate from \ref{it:prop:funt&fun-have-the-same-system-of-lengths(i)}.
	Moreover, the inclusion from left to right in \ref{it:prop:funt&fun-have-the-same-system-of-lengths(ii)} is precisely the content of Proposition \ref{prop:pm-arith}\ref{it:prop:pm-arith(v)}, and the other inclusion will follow from \ref{it:prop:funt&fun-have-the-same-system-of-lengths(i)} and Propositions \ref{prop:unit-adjust}\ref{it:prop:unit-adjust(i)} and \ref{prop:pm-arith}\ref{it:prop:pm-arith(iv)}.
	Therefore, we focus on \ref{it:prop:funt&fun-have-the-same-system-of-lengths(i)} for the remainder of the proof.
	
	\ref{it:prop:funt&fun-have-the-same-system-of-lengths(i)} By Proposition \ref{prop:pm-arith}\ref{it:prop:pm-arith(iv)}, $\jmath$ satisfies \ref{def:equimorphism(E1)}.
	Moreover, $\jmath$ is essentially surjective, as any $X\in \mathcal P_\funt(H)$ contains a unit $u \in H^\times$, so $u^{-1}X\in \mathcal P_\fun(H)$ and $X = u(u^{-1}X)$ is associate to an element of $\mathcal P_\fun(H)$. 

	To prove \ref{def:equimorphism(E2)}, let $A\in\A(\mathcal P_\fun(H))$.
	We aim to show that $A$ is an atom of $\mathcal P_\funt(H)$. Suppose that $A = XY$ for some $X,Y\in \mathcal P_\funt(H)$. Then there are $x \in X$ and $y \in Y$ with
	$xy=1_H$; and using that $H$ is Dedekind-finite, we get from Proposition \ref{prop:unit-adjust}\ref{it:prop:unit-adjust(0)} that $x,y\in H^\times$.
	It follows that 
	\[
	A = XY = (Xx^{-1})(xY)
	\quad\text{and}\quad
	Xx^{-1}, xY\in \mathcal P_\fun(H). 
	\]
	But then
	$Xx^{-1} = \{1_H\}$ or $xY = \{1_H\}$, since $\mathcal P_\fun(H)$ is a reduced monoid and $A$ is an atom of $\mathcal P_\fun(H)$.
	So, $X$ or $Y$ is a $1$-element subset of $H^\times$, and hence $A \in \A(\mathcal P_\funt(H))$. 
	 
	
	It remains to show that $\jmath$ satisfies \ref{def:equimorphism(E3)}.  Pick $X \in \mathcal P_\fun(H)$. If $X = \{1_H\}$, the conclusion holds vacuously. Otherwise, let $\mathfrak{b} := B_1*\cdots*B_n \in \mathcal Z_{\mathcal P_\fun(H)}(X)$. Then there are $u_1\in B_1,\ldots, u_n\in B_n$ such that $1_H = u_1\cdots u_n$; and as in the proof of \ref{def:equimorphism(E2)}, it must be that $u_1,\ldots, u_n\in H^\times$.
	Accordingly, we take, for every $i \in [ 1, n ]$, $A_i := u_0 \cdots u_{i-1} B_i u_i^{-1} \cdots u_1^{-1}$, where $u_0 := 1_H$.
	Then 
	\[
	A_1 \cdots A_n = X
	\quad\text{and}\quad
	1_H \in A_1 \cap \cdots \cap A_n;
	\]
	and by Propositions \ref{prop:unit-adjust}\ref{it:prop:unit-adjust(i)} and \ref{prop:pm-arith}\ref{it:prop:pm-arith(v)}, $A_1, \ldots, A_n$ are atoms of $\mathcal P_{\fun}(H)$. This shows that $\mathfrak{a}:= A_1*\cdots * A_n \in \mathcal{Z}_{\mathcal P_\fun(H)}(X)$. Since $A_i \simeq_{\mathcal P_\funt(H)} B_i$ for each $i \in [ 1, n ]$ (by construction), we thus conclude that $\mathfrak{a}$ is $\mathcal P_{\funt}(H)$-equivalent to $\mathfrak{b}$, as wished.
%	
\end{proof} 
%
The next example proves that Dedekind-finiteness is, to some extent, necessary for Proposition \ref{prop:funt&fun-have-the-same-system-of-lengths}\ref{it:prop:funt&fun-have-the-same-system-of-lengths(ii)}, and hence for the subsequent conclusions. 
%
\begin{eg}\label{exa:no-dedekind-finiteness}
Let $\mathcal{B}$ be the set of all binary sequences $\mathfrak{s}: \NN_{\ge1} \to \{0,1\}$, and let $H$ denote the monoid of all functions $\mathcal{B} \to \mathcal{B}$ under composition.  We will write $H$ multiplicatively; so, if $f, g \in H$ then $fg$ is the map $\mathcal{B} \to \mathcal{B}: \mathfrak{s} \mapsto f(g(\mathfrak s))$.
Further, let $n\ge 5$ and consider the functions 
\begin{align*}
L: \mathcal{B} \to\mathcal{B}: (a_1,a_2,\dots) &\mapsto (a_2,a_3,\dots)  &\,\textrm{(left shift);}\\
R: \mathcal{B} \to\mathcal{B}: (a_1,a_2,\dots) &\mapsto (0,a_1,a_2,\dots) &\,\textrm{(right shift);}\\
P: \mathcal{B} \to\mathcal{B}: (a_1,a_2,\dots) &\mapsto (a_{n},a_1,\dots, a_{n-1}, {a_{n+1}, a_{n+2}},\ldots) &\,\textrm{(cycle the first $n$ terms).}
\end{align*}
%
In particular, $P \in H^\times$. Also, $LR = \operatorname{id}_\mathcal{B}$ but $RL \neq \operatorname{id}_\mathcal{B}$; whence $H$ is not Dedekind-finite, and neither $R$ nor $L$ is invertible. With this in mind, we will prove that $A:= \{L,P\} \cdot \{R,P\} = \{\operatorname{id}_\mathcal{B}, LP, PR, P^2 \}$ is an atom of $\P_\fun(H)$, although it is not, by construction, an atom of $\P_\funt(H)$.

Indeed,
assume $A = XY$ for some $X,Y\in \P_\fun(H)$.
Then $X,Y\subseteq A$, and it is clear that $P^2 \ne PRLP$, or else $RL = {\rm id}_\mathcal{B}$ (a contradiction). Similarly, $PRPR \ne P^2 \ne LPLP$; otherwise, $P = RPR$ and hence $R$ is invertible, or $P = LPL$ and $L$ is invertible (again a contradiction). Lastly, we see that $P^2 \ne LP^2 R$, by applying both $P^2$ and $LP^2 R$ to the constant sequence $(1, 1, \ldots)$.

It follows that $P^2$ must belong to $X$ or $Y$, but not to both (which is the reason for choosing $n\ge 5$).
Accordingly, let $P^2 \in X \setminus Y$ (the other case is analogous).
Then $Y = \{\operatorname{id}_\mathcal{B}\}$, since one can easily check that $P^2LP, P^3R \notin A$, by noting that the action of $P^2LP$ and $P^3R$ differ from that of $A$ on the sequences $(1,1,\ldots)$ and $(1,0,1,1,\ldots)$. This makes $A$ an atom of $\P_\fun(H)$.
\end{eg}

\section{Atomicity and Bounded Factorization in Power Monoids} \label{sec:atomicity}

We get from Proposition \ref{prop:funt&fun-have-the-same-system-of-lengths} that studying factorization properties of $\P_\fun(H)$ is sufficient for studying corresponding properties of $\P_\funt(H)$, at least in the case when $H$ is Dedekind-finite.
Thus, as a starting point in the investigation of the arithmetic of $\P_\fun(H)$, one might wish to give a comprehensive description of
the atoms of $\P_\fun(H)$.
This is however an overwhelming task even in specific cases (e.g., when $H$ is the additive group of the integers), let alone the general case. Nevertheless, we can obtain basic information about $\A(\P_\fun(H))$ in full generality.
%
%
\begin{lemma}\label{lem:2-elt-atoms}
Let $H$ be a monoid and $x \in H \setminus \{1_H\}$.
The following hold:
\begin{enumerate}[label={\rm (\roman{*})}]
%
\item\label{it:lem:2-elt-atoms(i)} The set $\{1_H, x\}$ is an atom of $\P_\fun(H)$ if and only if $1_H \ne x^2 \ne x$.
\item\label{it:lem:2-elt-atoms(ii)} If $x^2=1_H$ or $x^2=x$, then $\{1_H,x\}$ factors into a product of atoms neither in $\P_{\fin,1}(H)$ nor in $\P_\funt(H)$.
\end{enumerate}
\end{lemma}
%
\begin{proof}
\ref{it:lem:2-elt-atoms(i)} If $x^2 = 1_H$ or $x^2 = x$, then it is clear that $\{1_H,x\} = \{1_H,x\}^2$, and therefore $\{1_H,x\}$ is not an atom of $\mathcal P_\fun(H)$. As for the converse, assume that $\{1_H,x\} = YZ$ for some non-units $Y,Z \in \mathcal P_\fun(H)$. Then we get from Proposition \ref{prop:pm-arith} that $Y$ and $Z$ are $2$-element sets, namely, $Y = \{1_H, y\}$ and $Z = \{1_H, z\}$ with $y,z \in H \setminus \{1_H\}$. Hence $\{1_H,x\} = YZ = \{1_H,y,z,yz\}$, and immediately this implies $x=y=z$. Therefore, $\{1_H,x\} = \{1_H,x,x^2\}$, which is only possible if $x^2 = 1_H$ or $x^2 = x$.

\ref{it:lem:2-elt-atoms(ii)} Suppose that $x^2 = 1_H$ or $x^2 = x$. Then the calculation above shows that $\{1_H,x\} = \{1_H,x\}^2$ and there is no other decomposition of $\{1_H,x\}$ into a product of non-unit elements of $\mathcal P_{\fin,1}(H)$. So, $\{1_H,x\}$ is a non-trivial idempotent (hence, a non-unit) and has no factorization into atoms of $\mathcal P_{\fin,1}(H)$.

It remains to prove the analogous statement for $\mathcal P_{\fin,\times}(H)$.
{Assume to the} contrary that $\{1_H,x\}$ factors into a product of $n$ atoms of $\mathcal P_{\fin,\times}(H)$ for some $n \in \NN_{>0}$. Then $n \ge 2$, since $\{1_H, x\}$ is a non-trivial idempotent (and hence not an atom itself). Consequently, we can write $\{1_H,x\} = YZ$, where $Y$ is an atom and $Z$ a non-unit of $\mathcal P_{\fin,\times}(H)$. In particular, we get from parts \ref{it:prop:pm-arith(i)}, \ref{it:prop:pm-arith(ii)}, and \ref{it:prop:pm-arith(iv)} of Proposition \ref{prop:pm-arith} that both $Y$ and $Z$ are $2$-element sets, say, $Y = \{u, y\}$ and $Z = \{v, z\}$. It is then immediate that there are only two possibilities: $1_H$ is the product of two units from $Y$ and $Z$, or the product of two non-units from $Y$ and $Z$.
Without loss of generality, we are thus reduced to considering the following cases.
\vskip 0.1cm
\textsc{Case 1:} $uv=1_H$. Then $uz \ne 1_H$ (or else $z = u^{-1} = v$, contradicting the fact that $Z$ is a $2$-element set). So $uz=x$, and similarly $yv=x$. Then $y = xu = uzu$ and $z = xv = vyv$, and therefore
\[
\{u,y\} = \{u,uzu\} = \{1_H,uz\}\cdot \{u\} = \{1_H,x\}\cdot\{u\} = \{u,y\}\cdot \{vu,zu\}
\]
However, this shows that $\{u,y\}$ is not an atom of $\P_\funt(H)$, in contrast with our assumptions.
\vskip 0.1cm
\textsc{Case 2:}
$yz = 1_H$ and $y,z\in H\setminus H^\times$. Then $u,v\in H^\times$, by the fact that $\{u, y\}, \{v, z\} \in \mathcal P_{\fin,\times}(H)$; and we must have $uz=x$, for $uz=1_H$ would yield $z = u^{-1}\in H^\times$.
In particular, $x = uz$ is not a unit in $H$, so $uv=1_H$ and we are back to the previous case.
\end{proof}
%
We have just seen that, to even {\it hope} for $\P_\fun(H)$ to be atomic, we must have that the ``bottom layer'' of $2$-element subsets of $H$ consists only of atoms, and it will turn out that such a condition is also sufficient.
Before proving this, it seems appropriate to point out some structural implications of the fact that every non-identity element of $H$ is neither an idempotent nor a square root of $1_H$.
%
\begin{lemma}\label{lem:no-non-id-elts-of-small-order-implies-structure}
	Let $H$ be a monoid such that $1_H \ne x^2 \ne x$ for all $x\in H\setminus\{1_H\}$. The following hold:
	%
	\begin{enumerate}[label={\rm (\roman{*})}]
		\item\label{it:lem:no-non-id-elts-of-small-order-implies-structure(i)}
		$H$ is Dedekind-finite.
		\item\label{it:lem:no-non-id-elts-of-small-order-implies-structure(ii)}
		If $x \in H$ and $\gen{x}_H$ is finite, then $x \in H^\times$ and $\gen{x}_H$ is a cyclic group of order $\ge 3$.
	\end{enumerate}
\end{lemma}
%
\begin{proof}
	\ref{it:lem:no-non-id-elts-of-small-order-implies-structure(i)}
	Let $y,z\in H$ such that $yz = 1_H$. Then $(zy)^2 = z(yz)y = zy$, and since $H$ has no non-trivial i\-dem\-po\-tents, we conclude that $zy=1_H$. Consequently, $H$ is Dedekind-finite.
	
	\ref{it:lem:no-non-id-elts-of-small-order-implies-structure(ii)}
	This is an obvious consequence of \cite[Ch. V, Exercise 4, p. 68]{Whitelaw}, according to which every finite semigroup has an idempotent.
	The proof is short, so we give it here for the sake of self-containedness.
	
	Because $\gen{x}_H$ is finite, there exist $n, k \in \NN_{>0}$ such that $x^n = x^{n+k}$, and by induction this implies that $x^n = x^{n+hk}$ for all $h \in \NN$. Therefore, we find that
	\[
	(x^{nk})^2 = x^{2nk} = x^{(k+1)n}x^{(k-1)n} = x^n x^{(k-1)n} = x^{nk}.
	\]
	But $H$ has no non-trivial idempotents, thus it must be the case that $x^{nk}=1_H$. That is, $x$ is a unit of $H$, and we have $x^{-1} = x^{nk-1} \in \gen{x}_H$. So, $\gen{x}_H$ is a (finite) cyclic group of order $\ge 3$.
\end{proof}

%

\begin{thm}\label{th:atomicity}
	Let $H$ be a monoid. Then $\mathcal P_\fun(H)$ is atomic if and only if $1_H \ne x^2 \ne x$ for every $x \in H \setminus \{1_H\}$.
\end{thm}
%
\begin{proof}
	The ``only if'' part is a consequence of Lemma \ref{lem:2-elt-atoms}\ref{it:lem:no-non-id-elts-of-small-order-implies-structure(ii)}.
	As for the other direction, assume that $1_H \ne x^2 \ne x$ for each $x\in H\setminus\{1_H\}$, and fix $X \in \mathcal P_{\fun}(H)$ with $|X| \ge 2$.
	We wish to show that 
	\[
	X = A_1 \cdots A_n, \quad\text{for some }A_1, \ldots, A_n \in \A(\mathcal P_{\fin,1}(H)).
	\]
	If $X$ is a $2$-element set, the claim is true by Lemma \ref{lem:2-elt-atoms}\ref{it:lem:no-non-id-elts-of-small-order-implies-structure(i)}. So let $|X| \ge 3$, and suppose inductively that every $Y \in \P_\fun(H)$ with $2 \le |Y| < |X|$ is a product of atoms. If $X$ is an atom, we are done.
	Otherwise, $X = A B$ for some non-units $A, B \in \P_\fun(H)$, and by symmetry we can assume $|X| \ge |A| \ge |B| \ge 2$. 
	
	If $|A| < |X|$, then both $A$ and $B$ factor into a product of atoms (by the inductive hypothesis), and so too does $X=A B$. Consequently, we are only left to consider the case when $|X| = |A|$. 
	
	For, we notice that 
	$
	A \cup B \subseteq A B = X 
	$
	(because $1_H \in A \cap B$), and this is only possible if $A = X$ (since $|A| = |X|$ and $A \subseteq X$). So, to summarize, we have that
	\begin{equation}\label{equ:containments}
		|X| \ge 3, \quad |B| \ge 2, \quad\text{and}\quad B \subseteq AB = X = A.
	\end{equation}
	In particular, since $B$ is not a unit of $\mathcal P_{\fin,1}(H)$, we can choose an element $b\in B\setminus\{1_H\} \subseteq A$. Hence, taking $A_b := A \setminus \{b\}$, we have $|A_b| < |A|$, and it is easy to check that $A_b B = A = X$ (in fact, $1_H$ is in $A_b \cap B$, and therefore we derive from \eqref{equ:containments} that $
	A_b B \subseteq A = A_b \cup \{b\} \subseteq A_b B \cup \{b\} \subseteq A_b B \cup B = A_b B$).
	
	If $|B|<|A|$, then we are done, because $A_b$ and $B$ are both products of atoms (by the inductive hypothesis), and thus so is $X = AB = A_bB$.
	Otherwise, it follows from \eqref{equ:containments} and the above that 
	\begin{equation}\label{equ:further-identities}
		X = A = B = A_b B \quad\text{and}\quad |A| \ge 3, 
	\end{equation}
	so we can choose an element $a \in A \setminus\{1_H,b\}$. Accordingly, set $B_a := B \setminus \{a\}$. Then $|B_a| < |B|$ (because $A = B$ and $a \in A$), and both $A_b$ and $B_a$ decompose into a product of atoms (again by induction). But this finishes the proof, since it is straightforward from \eqref{equ:further-identities} that $X = A = A_b B_a$ (indeed, $1_H \in A_b \cap B_a$ and $b \in B_a$, so we find that $
	A_b B_b \subseteq A = A_b \cup \{b\} \subseteq A_b B_a \cup \{b\} \subseteq A_b B_a \cup B_a = A_b B_a$).
\end{proof}

Now with Proposition \ref{prop:equimorphism} and Theorem \ref{th:atomicity} in hand, we can engage in a finer study of the arithmetic of Power monoids; in particular, we may wish to study their (systems of) sets of lengths. However, we are immediately met with a ``problem'' (i.e., some sets of lengths are infinite in a rather trivial way):
%
\begin{eg}\label{unbounded-fzn}
	Let $H$ be a monoid with an element $x$ of finite odd order $m \ge 3$, and set $X := \{x^k : k \in \NN \}$. Then it is clear that $X$ is the setwise product of $n$ copies of $\{1_H, x\}$ for every $n \ge m$. This shows that the set of lengths of $X$ relative to $\P_\fun(H)$ contains $[ m, \infty ]$ (and hence is infinite), since we know from Lemma \ref{lem:2-elt-atoms} that $\{1_H, x\}$ is an atom of $\P_\fun(H)$.
\end{eg}
%
The nature of this problem is better clarified by our next result, and we will more thoroughly address it in Section \ref{sec:minimal-factorizations}.
%
\begin{thm}\label{thm:BF-torsion}
Let $H$ be a monoid. The following hold:
\begin{enumerate}[label={\rm (\roman{*})}]
\item\label{it:thm:BF-torsion(i)} If $H$ is torsion-free and $X\in \P_\fun(H)$, then $\sup \mathsf{L}_{\mathcal P_\fun(H)}(X) \le |X|^2-|X|$.
\item\label{it:thm:BF-torsion(ii)} $\P_\fun(H)$ is \textup{BF} if and only if $H$ is torsion-free.
\item\label{it:thm:BF-torsion(iii)} $\P_\funt(H)$ is \textup{BF} if and only if so is $\mathcal P_\fun(H)$.
\end{enumerate}
\end{thm}

\begin{proof}
	\ref{it:thm:BF-torsion(i)}
	Set $n := |X| \in \NN_{>0}$, fix an integer $\ell \ge (n-1)n + 1$, and suppose for a contradiction that $X = A_1\cdots A_\ell$ for some $A_1,\dots, A_\ell\in \A(\P_\fun(H))$.
	By the Pigeonhole Principle, there are an element $x\in X$ and a subset $I \subseteq [ 1,\ell ]$ such that $m := |I| \ge n$ and $x \in A_i$ for each $i\in I$.
	So, writing $I = \{i_1,\ldots, i_m\}$, we find that $x^k \in A_{i_1} \cdots A_{i_k} \subseteq A_1\cdots A_\ell = X$ for every $k \in [ 1, m ]$, i.e., $\{1_H,x,\dots, x^m\} \subseteq X$.
	However, since $H$ is torsion-free, each power of $x$ is distinct, and hence $n = |X| \ge m+1 > n$ (a contradiction).
	
	\ref{it:thm:BF-torsion(ii)}
	First suppose for a contradiction that $\P_\fun(H)$ is BF and has an element $x$ of finite order $m$. Then $\P_\fun(H)$ is also atomic, and we know by Theorem \ref{th:atomicity} and Lemma \ref{lem:no-non-id-elts-of-small-order-implies-structure}\ref{it:lem:no-non-id-elts-of-small-order-implies-structure(ii)} that $x^m = 1_H$.
	If $m$ is even, then $(x^{m/2})^2 = 1_H$, contradicting the atomicity of $\P_\fun(H)$ since, by Theorem \ref{th:atomicity}, no non-identity element of $H$ can have order 2. 
	If $m$ is odd, then Example \ref{unbounded-fzn} shows that the set of lengths of $\{x^k : k \in \NN \}$ is infinite, contradicting the assumption that $\P_\fun(H)$ is BF.
	
	Conversely, assume $H$ is torsion-free. Then all powers of non-identity elements are distinct, so Theorem \ref{th:atomicity} implies that $\P_\fun(H)$ is atomic, and \ref{it:thm:BF-torsion(i)} gives an explicit upper bound on the lengths of factorizations.
	
	\ref{it:thm:BF-torsion(iii)} 
	The ``only if'' part follows from \cite[Theorem 2.28(iv) and Corollary 2.29]{fan-tringali18}, so suppose that $\P_\fun(H)$ is BF.
	Then $\P_\fun(H)$ is atomic, and hence, by Theorem \ref{th:atomicity}, $1_H \neq x^2 \neq x$ for all $x\in H\setminus\{1_H\}$.
	By Lemma \ref{lem:no-non-id-elts-of-small-order-implies-structure}\ref{it:lem:no-non-id-elts-of-small-order-implies-structure(i)}, this implies that $H$ is Dedekind-finite, so the natural embedding $\P_\fun(H)\hookrightarrow\P_\funt(H)$ is an essentially surjective equimorphism by Proposition \ref{prop:funt&fun-have-the-same-system-of-lengths}\ref{it:prop:funt&fun-have-the-same-system-of-lengths(i)}.
	The result is then an immediate consequence of Proposition  \ref{prop:funt&fun-have-the-same-system-of-lengths}\ref{it:prop:funt&fun-have-the-same-system-of-lengths(iv)}.
\end{proof}





